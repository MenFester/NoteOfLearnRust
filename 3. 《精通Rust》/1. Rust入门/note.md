# 学习笔记

## 前言

* 对于一种可能会改变你思考和推理代码的方式的语言，学习之初就需付出更多努力，并且认识到这一点非常重要

## 1.1 Rust是什么，以及为何需要关注它

* Rust是一种采用过去的知识解决将来的问题的技术
* Rust是一种快速、高并发、安全且具有授权性的编程语言
* Rust的运行时非常小，不需要垃圾收集，并且对于程序中声明的任何值，默认情况下更倾向于栈（stack）分配，而不是堆（heap）分配（开销）
* 虽然Rust是一种通用的多范式语言，但它的目标是C和C++占主导地位的系统编程领域（操作系统、游戏引擎、性能关键型应用）
* Rust还具有足够的表现力，你可以使用它构建高性能的Web应用程序、网络服务，类型安全的数据库对象关系映射（Object Relational Mapping，ORM）库，还可以将程序编译成WebAssembly在浏览器上运行
* Rust还在为嵌入平台构建安全性优先的实时应用程序方面获得了相当大的关注
* Rust作为一门静态和强类型语言而存在。静态属性意味着编译器在编译时具有所有相关变量和类型的信息，并且在编译时会进行大量检查，在运行时只保留少量的类型检查。强类型属性意味着不允许发生诸如类型之间自动转换的事情。强类型属性使Rust可以安全地重构代码，并在编译时捕获大多数错误，而不是在运行时出错
* Rust编写的程序表现力和性能都非常好，因为使用它你可以拥有高级函数式语言的大部分特性
* Rust很多设计决策中强调首要理念是编译期内存安全、零成本抽象和支持高并发
  * 编译期内存安全：Rust编译期可以在编译时跟踪程序中资源的变量。资源可以是内存地址，包含某个值的变量、共享内存引用、文件句柄、网络套接字或数据库连接句柄等。Rust中的引用类型（类型名称前面带有&标记的类型）与生命周期标记隐式关联（'foo），有时由程序员显示声明。在生命周期中，编译器可以跟踪代码中可以安全使用的位置。Rust通过这些引用上的生命周期标签来运行借用/引用检查算法，以确保你永远不能访问已释放的内存地址
  * 零成本抽象：编程的目的就是管理复杂性，这是通过良好的抽象来实现的。抽象让我们能够编写高级并且易于阅读的和推断的代码
  * 支持高并发：Rust是并发安全的，该语言具有应用程序接口（Application Programming Interface，API）和抽象能力，使得编写正确和安全的并发代码变得非常容易。Rust将数据包装成Mutex类型，以确保来自多个线程的数据进行同步可变访问。Rust采用了保护共享数据自身，而不是代码的概念。另一个新颖的想法是标记特征的概念，它在编译期验证，并确保在并发代码中同步和安全地访问数据。类型会被称为Send和Sync的标记特征进行注释标记，以指示它们是否可以安全地发送到线程或者在线程之间共享。当程序向线程发送值时，编译器会检查该值是否实现了所需的标记特征，如果没有，则禁止使用该值。当前CPU没有获得更多的时钟频率；相反，添加了更多内核。因此，并发编程是正确的发展方向。Rust使得编写并发代码变得轻而易举，并且降低了编写安全的并发代码的门槛。
* Rust还借鉴了C++的RAII原则用于资源初始化，这种技术的本质是将资源的生命周期和对象的生命周期绑定，而堆分配类型的解除分配是通过执行drop特征上的drop()方法实现的。当变量超出作用域时，程序会自动调用此方法。
* Rust还用Result和Option类型替代了空指针的概念，这意味着Rust不允许代码中出现null/undefinded的值，除非通过外部函数接口与其他语言交互，以及使用不安全代码时
* Rust语言还强调组合，而不是继承，并且有一套特征系统，它由数据类型实现

## 1.2 安装Rust工具链

* Rust工具链包含两个主要组件：编译器rustc和软件包管理器Cargo，后者有助于管理Rust项目。工具链发布有3个渠道：
  * 夜间版（Nightly）：主开发分支每天成功构建的程序，不是很稳定
  * 测试版（Beta）：该版本每6周发布一次，仅包含已经稳定的功能
  * 稳定版（Stable）：该版本每6周发布一次，测试分支会演变成新的稳定版本
* rustup是一款在所兼容的平台上安装Rust编译器的工具
  * 安装工具链的推荐做法是：` curl https://sh.rustup.rs -sSf | sh `
  * 将工具链更新到最新版本：` rustup update `
  * rustup更新自身的版本：` rustup self update `
  * 查看默认配置：` rustup show `
  * 告知rustup针对特定目录切换到夜间版本的工具链：` rustup override set nightly `，相应文件夹及其子目录的rustc、cargo等命令版本会自动切换到夜间版本
  * 如果由于某种原因想使用较旧版本的工具链或者对工具链进行降级，可以通过运行 ` rustup install nightly-2016-06-03 ` 命令，然后使用override子命令来达到目的

## 1.3 Rust简介

* 在较高层面，Rust程序会被组织成模块的形式，根模块会包含一个main()函数。
  * 对于二进制可执行项目，根模块通常是一个main.rs文件
  * 而对于程序库，根模块通常是一个lib.rs文件
* print!宏：
  * 对于"{}"格式化声明符，它会调用一个来自Display特征的方法
  * 对于"{:?}"格式化声明符，它会调用一个来自Debug特征的方法
  * 在开发过程中，通常需要输出数据类型以进行调试。使用"{:?}"格式化声明符时，上述方法在类型上是不可用的，我们需要在类型上添加`#[derive(Debug)]`属性来获取这些方法
* Rust中内置基元类型有
  * bool：布尔值，可以是true、false
  * char：字符
  * 整型（integer），支持最大长度128位
    * 有符号：i8，i16，i32，i64，i128
    * 无符号：u8，u16，u32，u64，u128
  * isize：指针大小的有符号整型。相当于32位CPU上的i32和64位CPU上的i64
  * usize：指针大小的无符号整型。相当于32位CPU上的u32和64位CPU上的u64
  * f32：32位浮点型
  * f64：64位浮点型
  * [T; N]：固定大小的数组，T表示数据类型，N表示元素数目
  * [T]：动态大小的连续序列的视图，T表示任意类型
  * str：字符串切片，主要用作引用，即&str。在 Rust 中有两种常用的字符串类型：str 和 String。str 是 Rust 核心语言类型，就是本章一直在讲的字符串切片（String Slice），常常以引用的形式出现（&str）。凡是用双引号包括的字符串常量整体的类型性质都是 &str。String 类型是 Rust 标准公共库提供的一种数据类型，它的功能更完善——它支持字符串的追加、清空等实用的操作。String 和 str 除了同样拥有一个字符开始位置属性和一个字符串长度属性以外还有一个容量（capacity）属性。String 和 str 都支持切片，切片的结果是 &str 类型的数据。注意：切片结果必须是引用类型
  * (T, U, ..)：有限序列，T、U可以是不同类型
  * fn(i32) -> i32：一个接收i32类型参数并返回i32类型参数的函数